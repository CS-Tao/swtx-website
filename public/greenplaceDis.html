<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<style>
		html,
		body,
		#arcgismap {
			padding: 0;
			margin: 0;
			height: 100%;
			width: 100%;
		}
	</style>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Energy &mdash; 100% Free Fully Responsive HTML5 Template by FREEHTML5.co</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Template by FREEHTML5" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
	<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
	<!-- Compiled and minified CSS -->
	<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css">-->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
	 crossorigin="" />

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<link rel="stylesheet" href="css/MarkerCluster.css" />
	<link rel="stylesheet" href="css/MarkerCluster.Default.css" />

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	 crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
	 crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	 crossorigin="anonymous"></script>

	<meta property="og:title" content="" />
	<meta property="og:image" content="" />
	<meta property="og:url" content="" />
	<meta property="og:site_name" content="" />
	<meta property="og:description" content="" />
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet"> -->

	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Simple Line Icons -->
	<link rel="stylesheet" href="css/simple-line-icons.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Superfish -->
	<link rel="stylesheet" href="css/superfish.css">
	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>



	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

</head>

<body>
	<div id="fh5co-wrapper">
		<div id="fh5co-page">
			<div id="fh5co-header">
				<header id="fh5co-header-section">
					<div class="container">
						<div class="nav-header">
							<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
							<h1 id="fh5co-logo"><a href="index.html">首页</a></h1>
							<!-- START #fh5co-menu-wrap -->
							<nav id="fh5co-menu-wrap" role="navigation">
								<ul class="sf-menu" id="fh5co-primary-menu">
									<!-- 	<li>
									<a class="active" href="index.html">Home</a>
								</li> -->
									<li><a class="active" href="greenplaceDis.html">武汉市公园夜跑推荐</a></li>
									<li><a href="PMDis.html">武汉夜跑环境可视化</a></li>
									<li><a href="3D.html">三维实景</a></li>
									<li><a href="Safe.html">夜跑安全</a></li>
									<li><a href="contact.html">APP功能展示</a></li>
								</ul>
							</nav>
						</div>
					</div>
				</header>
			</div>

			<!-- end:fh5co-header -->

			<aside id="fh5co-hero" class="js-fullheight">
				<div class="flexslider js-fullheight">
					<ul class="slides">
						<!--<li>-->
						<div>
							<div id="mapiddd" style="height: 600px;z-index:0; margin-left: 200px;margin-right: 200px;"></div>

							<!--<div class="dropdown" style = "float: right;margin-top : -600px;margin-right:20px;" >
				  <button class="btn btn-default dropdown-toggle btn-xs dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
   					选择跑步时间
   					
					  </button>
					  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
					    <li><a href="#">Action</a></li>
					    <li><a href="#">Another action</a></li>
					    <li><a href="#">Something else here</a></li>
					    <li><a href="#">Separated link</a></li>
					  </ul>
					</div>-->
							<p>
								<button type="button" onclick="getLocation()" style="position: absolute;z-index:10;margin-top : -570px;margin-left:1200px;background: white;">当前附近公园</button>
							</p>

							<h6 style="position:absolute; float: right;margin-top : -610px;margin-left:1390px;width:180px;height: 30px;">
								选择跑步时间:
							</h6>
							<select id="choose" style="float: right;margin-top : -580px;margin-right:20px;width:180px;height: 30px;">
								<option value="20">20min</option>
								<option value="40">40min</option>
								<option value="60">60min</option>
								<option value="90">90min</option>
							</select>
							<p>
								<button type="button" onclick="getBestGP()" style="float: right;margin-top : -540px;margin-right:20px;background: white;">最佳公园</button>
							</p>


						</div>


					</ul>
				</div>
			</aside>
		</div>
		<!-- END fh5co-page -->

	</div>
	<!-- END fh5co-wrapper -->

	<!-- jQuery -->


	<script src="./js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="./js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="./js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="./js/jquery.waypoints.min.js"></script>
	<!-- Superfish -->
	<script src="./js/hoverIntent.js"></script>
	<script src="./js/superfish.js"></script>
	<!-- Flexslider -->
	<script src="./js/jquery.flexslider-min.js"></script>
	<!-- Stellar -->
	<script src="./js/jquery.stellar.min.js"></script>
	<!-- Counters -->
	<script src="./js/jquery.countTo.js"></script>
	<!--<script src="leaflet.markercluster-src.js"></script>-->
	<!--<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>-->

	<!--<script type="text/javascript" src="http://leafletjs.com/examples/us-states.js"></script>-->

	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js"></script>-->
	<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js" integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA==" crossorigin=""></script>
	<!--<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
    <script type="text/javascript" src="http://leafletjs.com/examples/us-states.js"></script>-->
	<link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/css/main.css">
	<script src="https://code.jquery.com/jquery-3.2.0.js"></script>
	<script src="https://js.arcgis.com/4.3/"></script>
	<script src="arcgis-map.js"></script>
	<!-- Main JS (Do not remove) -->
	<script src="js/main.js"></script>
	<script src="js/greenPlace.js"></script>
	<script type="text/javascript">
		var greenplace_map = L.map('mapiddd').setView([30.55, 114.29], 10);
		L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'			//用人家的底图也不好意思还是先加上copyright吧
		}).addTo(greenplace_map);


		//添加底图
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
			maxZoom: 18,
			id: 'mapbox.streets',
			accessToken: 'your.mapbox.access.token' // 要写你自己的accessToken这是啥？不懂
		}).addTo(greenplace_map);

		for (var item = 0; item < 210; item++) {
			var latlngs = GPData.features[item].geometry.rings[0];
			for (var i = 0; i < latlngs.length; i++) {
				latlngs[i] = latlngs[i].reverse();
			}
			var content = GPData.features[item].attributes;
			if (content.Area > 1000000) {
				var polygon = L.polygon(latlngs, { color: '#339900' }).addTo(greenplace_map);
			}
			else if (content.Area > 500000) {
				var polygon = L.polygon(latlngs, { color: '#009933' }).addTo(greenplace_map);
			}
			else if (content.Area > 300000) {
				var polygon = L.polygon(latlngs, { color: '#009966' }).addTo(greenplace_map);
			}
			else if (content.Area > 200000) {
				var polygon = L.polygon(latlngs, { color: '#33CC66' }).addTo(greenplace_map);
			}
			else if (content.Area > 100000) {
				var polygon = L.polygon(latlngs, { color: '#33FF99' }).addTo(greenplace_map);
			}
			else if (content.Area > 50000) {
				var polygon = L.polygon(latlngs, { color: '#33FF99' }).addTo(greenplace_map);
			}
			else if (content.Area > 10000) {
				var polygon = L.polygon(latlngs, { color: '#33FF99' }).addTo(greenplace_map);
			}
			var time = Math.sqrt(content.Area) * 10 / 300;


			var popupContent = 																			//添加每一点的具体信息
				"<p>" +
				//"企业名称：" 		+ c.InstitutionName 	+ "<br />" +
				"绿地名称： " + content.NAME + "<br/>" +
				"绿地面积： " + content.Area + "m²" + "<br/>" +
				"预计夜跑时间： " + time.toPrecision(2) + "min" + "<br/>"

				+ "</p>";
			var popup = L.marker(latlngs[0], { opacity: 0.0 }).bindPopup(popupContent).addTo(greenplace_map);




		}


		//  var info = L.control();

		// info.onAdd = function (greenplace_map) {
		//     this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
		//     this.update();
		//     return this._div;
		// };
		// function highlightFeature(e) {
		// 	 var layer = e.target;

		// 		layer.setStyle({
		// 		        weight: 5,
		// 		        color: '#666',
		// 		        dashArray: '',
		// 		        fillOpacity: 0.7
		// 		    });


		// 		layer.bringToFront();

		// 		info.update(layer.attributes);

		// }
		// highlightFeature(info);
		// // method that we will use to update the control based on feature properties passed
		// var attributes = GPData.features.attributes;
		// info.update = function (attributes) {
		//     this._div.innerHTML = '<h4>武汉市绿地分布图</h4>' +  (attributes ?
		//         '<b>' + attributes.NAME + '</b><br />' + attributes.Area + ' people / mi<sup>2</sup>'
		//         : 'Hover over a state');
		// };

		// info.addTo(greenplace_map);
		var lat, lon;
		var loc_end;
		function  getLocation() {
			if  (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			}
		}
		var GPnum = 0;
		var posGP = [];
		function  showPosition(position) {
			lat = position.coords.latitude;
			lon = position.coords.longitude;
			greenplace_map.setView([lat, lon], 13);
			//查找当前位置最近的绿地

			for (var i = 0; i < 210; i++) {
				var latlngs = GPData.features[i].geometry.rings[0];
				var GP = GPData.features[i];
				if (Math.abs(latlngs[0][0] - lat < 0.06) && Math.abs(latlngs[0][1] -  lon) < 0.06) {
					//红色标出目标区域
					var polygonObject = L.polygon(latlngs, { color: 'red' }).addTo(greenplace_map);
					posGP[GPnum] = GP;
					GPnum++;
				}

			}

		}
		function getBestGP() {
			var myselect = document.getElementById("choose");
			var index = myselect.selectedIndex ;
			var runningTime = myselect.options[index].value;
			for (var i = 0; i < GPnum; i++) {
				var time = (Math.sqrt(posGP[i].attributes.Area) * 10 / 300);
				if (time > (runningTime - 10) && time < (runningTime + 10)) {
					// var popup = L.marker(latlngs[0],{opacity: 0.0}).bindPopup(popupContent).openOn(greenplace_map);
					// var popup = L.marker((posGP[i].geometry.rings[0],{opacity: 0.0}).bindPopup(popupContent).openOn(greenplace_map);
					//var time = (Math.sqrt(posGP[i].attributes.Area)/30);
					var popupContent = 																			//添加每一点的具体信息
						"<p>" +
						//"企业名称：" 		+ c.InstitutionName 	+ "<br />" +
						"绿地名称： " + posGP[i].attributes.NAME + "<br/>" +
						"绿地面积： " + posGP[i].attributes.Area + "m²" + "<br/>" +
						"预计夜跑时间： " + time.toPrecision(2) + "min" + "<br/>"
						// +"<button onclick = "+"navi()"+">导航</button>"+"<br/>"
						+ "</p>";
					var loc = posGP[i].geometry.rings[0];
					var popup = L.popup()
						.setLatLng(loc[0])
						.setContent(popupContent)
						.openOn(greenplace_map);
					greenplace_map.setView(loc[0], 13);
					loc_end = loc[0]

				}
			}
		}
		function navi() {
			//导航？
		}
		// 		function getHouse(){

		// function ArcGIS_Map_Init() {
		//     require([
		//         "esri/layers/GroupLayer",
		//         "esri/layers/FeatureLayer",
		//         "esri/Map", 
		//         "esri/views/SceneView",
		//         "esri/widgets/LayerList",
		//         "esri/layers/support/Field",
		//         "esri/geometry/Point",
		//         "esri/renderers/SimpleRenderer",
		//         "esri/symbols/PointSymbol3D",
		//         "esri/symbols/ObjectSymbol3DLayer",
		//         "esri/request",
		//         "dojo/_base/array",
		//         "dojo/dom",
		//         "dojo/on",
		//         "dojo/domReady!"
		//     ], function (GroupLayer, FeatureLayer, Map, SceneView, LayerList, Field, Point, SimpleRenderer, PointSymbol3D, ObjectSymbol3DLayer, esriRequest, 
		//     arrayUtils, dom, on) {

		//         var arcgis_fields = [
		//             {name: "ObjectID", alias: "ObjectID", type: "oid"},
		//             {name: "title", alias: "title", type: "string"},
		//             {name: "num", alias: "num", type: "integer"}
		//         ];

		//         arcgis_groupLayer = new GroupLayer({
		//             title: "商品房",
		//             visibility: true,
		//             visibilityMode: "exclusive"
		//         })

		//         var arcgis_arcgismap = new Map({
		//             basemap: "osm",
		//             layers: [arcgis_groupLayer]
		//         });

		//         var arcgis_initCam = {
		//             position: {
		//                 x: 114.316200103,
		//                 y: 30.4110841269,
		//                 z: 200000,
		//                 spatialReference: {
		//                     wkid: 4326
		//                 }
		//             },
		//             heading: 0,
		//             tilt: 0
		//         };

		//          var arcgis_view = new SceneView({
		//              map:  arcgis_arcgismap,
		//              container: "arcgismap",
		//              camera: arcgis_initCam
		//          });

		//         arcgis_view.then(function () {
		//             arcgis_layerList = new LayerList({
		//                 view: arcgis_view
		//             })

		//             arcgis_view.ui.add(arcgis_layerList, "top-right");
		//         })

		//         $.getJSON("realproperty.json", function (data) {
		//             var graphics = [];

		//             data.forEach(function(iSender, i) {
		//                 graphics.push({
		//                     geometry: new Point({
		//                         longitude: iSender.fCoord_x,
		//                         latitude: iSender.fCoord_y
		//                     }),
		//                     attributes: {
		//                         ObjectID: iSender.sInstalmentID,
		//                         title: iSender.sTitle,
		//                         num: parseInt(iSender.fPriceAverage)
		//                     }
		//                 })
		//             }, this);

		//             var arcgis_fireRenderer = new SimpleRenderer({
		//                 symbol: new PointSymbol3D({
		//                     symbolLayers: [new ObjectSymbol3DLayer({
		//                         resource: {
		//                             primitive: "cube"
		//                         },
		//                         width: 500,
		//                         depth: 500,
		//                         material: {color: "#e6b600"}
		//                     })]
		//                 }),
		//                 label: "平均价格",
		//                 visualVariables: [{
		//                     type: "size",
		//                     field: "num",
		//                     axis: "height"
		//                 },{
		//                     type: "size",
		//                     axis: "width-and-depth",
		//                     useSymbolValue: true,
		//                 }]
		//             });

		//             var arcgis_fireLayer = new FeatureLayer({
		//                 source: graphics,
		//                 fields: arcgis_fields,
		//                 objectIdField: "ObjectID",
		//                 renderer: arcgis_fireRenderer,
		//                 spatialReference: {
		//                     wkid: 4326
		//                 },
		//                 geometryType: "point",
		//                 popupTemplate: {
		//                     title: "{title}",
		//                     content: [{
		//                         type: "fields",
		//                         fieldInfos: [{
		//                             fieldName: "num",
		//                             label: "平均价格",
		//                             visible: true
		//                         }]
		//                     }]
		//                 },
		//                 title: "平均价格",
		//                 id: "fireLayer"
		//             })

		//             arcgis_groupLayer.add(arcgis_fireLayer, 0);
		//         })
		//     })
		// }

		// // $(function () {
		// //     ArcGIS_Map_Init();
		// // })
		// ArcGIS_Map_Init();
		// 		}

		greenplace_map.setView([30.55, 114.29], 11);
	</script>
</body>

</html>